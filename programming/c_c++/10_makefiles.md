---
layout: default
title: C++ with Linux
permalink: /programming/c-c++/10_makefiles
---

<h1 style="text-align: center;">Files Organization and Makefiles</h1>

Consider the following code:

``` c++
// main.cpp
#include <iostream>
#include <math.h>

//Prototypes of functions to perform arithmetic operations on arrays:
int sumInt(int*, int);
int prodInt(int*, int);
double sumDouble(double*, int);
int prodDouble(double*, int);

// Prototypes of functions to perform statistics operations
double calcMean(double*, int);
double calcStandardDeviation(double*, int);

int main(int argc, char **argv){
  int arrayInt[] = {5, 3, 7, 8, 4};
  double arrayDouble[] = {2.5, 4.7, 3.7, 3.3, 9.3};

  std::cout << "Arithmetic Operations" << std::endl;

  std::cout << "  sum of arrayInt = " << sumInt(arrayInt, 5) << std::endl;
  std::cout << "  prod of arrayInt = " << prodInt(arrayInt, 5) << std::endl;

  std::cout << "  sum of arrayDouble = " << sumDouble(arrayDouble, 5) << std::endl;
  std::cout << "  prod of arrayDouble = " << prodDouble(arrayDouble, 5) << std::endl;

  std::cout << "Statistics Operations" << std::endl;

  std::cout << "  mean of arrayDouble = " << calcMean(arrayDouble, 5) << std::endl;
  std::cout << "  std of arrayDouble = " << calcStandardDeviation(arrayDouble, 5) << std::endl;

  return 0;
}

//Functions to perform arithmetic operations on arrays:
int sumInt(int *array, int size){
  int sum = 0;
  for(int i=0; i<size; i++){
    sum += array[i];
  }
  return sum;
}

int prodInt(int *array, int size){
  int prod = 1;
  for(int i=0; i<size; i++){
    prod = array[i] * prod;
  }
  return prod;
}

double sumDouble(double *array, int size){
  double sum = 0.0;
  for(int i=0; i<size; i++){
    sum += array[i];
  }
  return sum;
}

int prodDouble(double *array, int size){
  double prod = 1;
  for(int i=0; i<size; i++){
    prod = array[i] * prod;
  }
  return prod;
}

// Functions to perform statistics operations
double calcMean(double *array, int size){
  double sum = sumDouble(array, size);
  return sum/size;
}

double calcStandardDeviation(double *array, int size){
  double mean = calcMean(array, size);
  double std = 0.0;
  for(int i=0; i<size; i++){
    std += pow(array[i] - mean, 2);
  }
  return sqrt(std/size);
}

```

It includes a set of functions (and their prototypes) to calculate some arithmetic operations, in addition, it also includes functions to calculate some statistics.

If you want to compile and execute this file, you must execute the following line:

``` bash
$ g++ -o main main.cpp
$ ./main
```

## Makefile

Suppose you want to automate the compilation process via a *Makefile*, so this file could be as follows:

``` make
main: main.cpp
  g++ -o main main.cpp

run:
  ./main
```

The *main* and *run* word are **rules**, and execute linux commands. Rules use to have the same name that the file the rule creates (for example, the rule *main* generates the binary *main*). After the rule name, you must include the requisites, that are the files needed to generate the file (to generate the binary *main*, you need the file *main.cpp*). *make* command knows when a rule is updated when the target of the rule (in this case the binary *main*) has a newest modification date than its requisites.

By default, when you execute *make*, it will be executed the first rule in the file. Then, you can compile with:

``` bash
$ make
```

and run it with:

``` bash
$ make run
```

If you try to *make* again, the commands of the rule wont be executed, and you will get a message like *"make: 'main' is up to date."*.

You can create rules that depends on files generated by other rules, consider the next Makefile:

``` Makefile
all: main

main: main.cpp
  g++ -o main main.cpp

run: main
  ./main
```

The *all* rule does not run commands, but it is the default rule and depends on the main rule, so when you run *make all*, make will check if the dependencies (*main*) are updated, if not, it runs that rules before executing itself. You can alse test it with the new *run* rule.

## Creating *Libraries*

We are going to reorganize the main.cpp program, and we are going to create the following files:

``` c++
// arithmetic.h

#ifndef ARITHMETIC_H
#define ARITHMETIC_H

int sumInt(int*, int);
int prodInt(int*, int);
double sumDouble(double*, int);
int prodDouble(double*, int);

#endif
```

``` c++
// arithmetic.cpp
#include "arithmetic.h"

int sumInt(int *array, int size){
  int sum = 0;
  for(int i=0; i<size; i++){
    sum += array[i];
  }
  return sum;
}

int prodInt(int *array, int size){
  int prod = 1;
  for(int i=0; i<size; i++){
    prod = array[i] * prod;
  }
  return prod;
}

double sumDouble(double *array, int size){
  double sum = 0.0;
  for(int i=0; i<size; i++){
    sum += array[i];
  }
  return sum;
}

int prodDouble(double *array, int size){
  double prod = 1;
  for(int i=0; i<size; i++){
    prod = array[i] * prod;
  }
  return prod;
}
```

``` c++
// statistics.h

#ifndef ARITHMETIC_H
#define ARITHMETIC_H

#include <math.h>
#include "arithmetic.h"

double calcMean(double*, int);
double calcStandardDeviation(double*, int);

#endif
```

``` c++
// statistics.cpp
#include "statistics.h"

double calcMean(double *array, int size){
  double sum = sumDouble(array, size);
  return sum/size;
}

double calcStandardDeviation(double *array, int size){
  double mean = calcMean(array, size);
  double std = 0.0;
  for(int i=0; i<size; i++){
    std += pow(array[i] - mean, 2);
  }
  return sqrt(std/size);
}
```

``` c++
// main.cpp
#include <iostream>
#include "arithmetic.h"
#include "statistics.h"

int main(int argc, char **argv){
  int arrayInt[] = {5, 3, 7, 8, 4};
  double arrayDouble[] = {2.5, 4.7, 3.7, 3.3, 9.3};

  std::cout << "Arithmetic Operations" << std::endl;

  std::cout << "  sum of arrayInt = " << sumInt(arrayInt, 5) << std::endl;
  std::cout << "  prod of arrayInt = " << prodInt(arrayInt, 5) << std::endl;

  std::cout << "  sum of arrayDouble = " << sumDouble(arrayDouble, 5) << std::endl;
  std::cout << "  prod of arrayDouble = " << prodDouble(arrayDouble, 5) << std::endl;

  std::cout << "Statistics Operations" << std::endl;

  std::cout << "  mean of arrayDouble = " << calcMean(arrayDouble, 5) << std::endl;
  std::cout << "  std of arrayDouble = " << calcStandardDeviation(arrayDouble, 5) << std::endl;

  return 0;
}
```

And the *Makefile* could be:

``` make
all: main

main: main.o arithmetic.o statistics.o
  g++ -o main main.o arithmetic.o statistics.o

main.o: main.cpp arithmetic.h statistics.h
  g++ -c -o main.o main.cpp

arithmetic.o: arithmetic.cpp arithmetic.h
  g++ -c -o arithmetic.o arithmetic.cpp

statistics.o: statistics.cpp statistics.h arithmetic.h
  g++ -c -o statistics.o statistics.cpp

run: main
  ./main

.PHONY: clean
clean:
  rm *.o main
```
